<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script
      src="https://code.jquery.com/jquery-3.5.1.js"
      integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
      crossorigin="anonymous"
    ></script>
    <title>생성페이지</title>

    <script>

    // function posting() {
    //     const img_url = $('#img_url')[0];
    //     console.log("img_url: ", img_url.files); // file 에 담음 (파일 여러개이면 img_url.files[0] 과 같은 방식으로 가져옴)

    //     // if(img_url.file.length === 0) {
    //     //   alert("파일을 선택해주세요.");
    //     //   return;
    //     // }

    //     const formData = new FormData();
    //     formData.append("files", img_url.files); // FormData 객체 안에 append

    //     // formData에 파일 잘 들어 갔는지 확인하기 위해 log 찍음
    //     for (const key of formData.keys()) {
    //       console.log(key); // image 로 출력
    //     }
    //     for (const value of formData.values()) {
    //       console.log(value);
    //     }

    //     const title = $("#title").val();
    //     console.log("title: " + title);
    //     const area = $("#area").val();
    //     const content = $('#content').val();
    //     let today = new Date();
    //     let year = today.getFullYear();
    //     let month = ('0' + (today.getMonth() + 1)).slice(-2);
    //     let day = ('0' + today.getDate()).slice(-2);
    //     const date = year + '-' + month + '-' + day;
    //     $.ajax({
    //       type: "POST",
    //       url: '/api/posts',
    //       headers: {
    //         authorization: `Bearer ${localStorage.getItem("token")}`,
    //       },
    //       data: {
    //         //img_url: img_url,
    //         title: title,
    //         area: area,
    //         content: content,
    //         date: date,
    //       },
    //       formData: img_url,
    //       // 이거 추가하는거 맞나 확인 필요
    //       //processData: false, // false로 선언 시 formData를 string으로 변환하지 않음
    //       //contentType: false, // false 로 선언 시 content-type 헤더가 multipart/form-data로 전송되게 함

    //       success: function (response) {
    //         if (response["result"] == "success") {
    //           console.log(img_url);
    //           alert('게시완료!');
    //           window.location.href = "/";
    //         }
    //       }
    //     });
    //   }


      /* 동작하는 코드
      function posting() {
        const img_url = $('#img_url').val();
        const title = $("#title").val();
        const area = $("#area").val();
        const content = $('#content').val();
        let today = new Date();
        let year = today.getFullYear();
        let month = ('0' + (today.getMonth() + 1)).slice(-2);
        let day = ('0' + today.getDate()).slice(-2);
        const date = year + '-' + month  + '-' + day;
        $.ajax({
          type: "POST",
          url: '/api/posts',
          headers: {
            authorization: `Bearer ${localStorage.getItem("token")}`,
          },
          data: {
            img_url: img_url,
            title: title,
            area: area,
            content: content,
            date: date,
          },
          success: function(response) {
            if (response["result"] == "success") {
              console.log(img_url);
              alert('게시완료!');
              window.location.href = "/";
            }
          }
        });
      }
      */

  $(function () {
    $("#img_url").on('change', function () {
      readURL(this);
    });
  });

  function readURL(input) {
    if (input.files && input.files[0]) {
      var reader = new FileReader();

      reader.onload = function (e) {
        $('#img_url').attr('src', e.target.result);
      }

      reader.readAsDataURL(input.files[0]);
    }
  }
    </script>
  </head>
  <body>
    <h3>게시글 등록</h3>
    <form action="/api/posts" method="post" enctype="multipart/form-data">
      <input type="file" id="img_url" name="file">
      <!-- <input type="submit" value="S3에 보내기"> -->
   
      <p>제목</p>
      <input type="text" id="title"></input>
      <label for="area">지역구 선택</label>
      <select name="area" id="area">
        <option value="강남구">강남구</option>
        <option value="강서구">강서구</option>
        <option value="강북구">강북구</option>
        <option value="강동구">강동구</option>
      </select>
      <p>내용</p>
      <input type="text" id="content"></input>
      <!-- <button onclick="posting()">등록</button> -->
      <input type="submit" value="등록">
      </form>
  </body>
</html>
